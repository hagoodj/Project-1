<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Directions Service</title>
    <style>

    </style>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="./style.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  </head>
  <body>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCoyW6mwyqQklL1EJHPwt5fwZNKCQ4erAo"></script>

  <div class = "container">
      <div class="jumbotron">
          <h1 class="display-4 row justify-content-center">Find Restaurants on Your Route!<i class="fa fa-map-marker"></i></h1>
      </div>
  </div>

     <div class = "container">
        <div class="card">
            <div class="card-body">
                <form>
                  <div class = "row">

                    <div class="form-group col-md-4">
                        <div class = "row justify-content-center"><label id = "start-label">Starting Location</label></div>
                        <div class = "row justify-content-center"><input type="text" id="start" /></div>
                    </div>
                    <div class="form-group col-md-4">
                        <div class = "row justify-content-center"><label id = "dest-label">Destination</label></div>
                        <div class = "row justify-content-center"><input type="text" id="end" /></div>
                    </div>
                    <div class="form-group col-md-3">
                        <div class = "row justify-content-center"><label id = "pref-label">Restaurant Preference</label></div>
                        <div class = "row justify-content-center"><input id="pref-input" type="text"></div>
                    </div>
                    <div class = "col-md-1">
                        <div class = "row justify-content-center"><label id = "pref-label">Search</label></div>
                        <div class = "row justify-content-center"><input type="button" class="fa fa-search" id="routebtn" value="&#xf002"></div>
                    </div>

                  </div>
                </form>
            </div>
        </div>
    </div>

    <br>
    
    <div class = "container" id="map-canvas"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <script type="text/javascript">

    $("#routebtn").on("click", function() {
      
      var startLoc = $("#start").val().trim();
      var endLoc = $("#end").val().trim();
      var queryURLStart = "https://api.opencagedata.com/geocode/v1/json?q=" + startLoc + "&key=5de65d8b73e24f3c873540d0515d0f0a";
      var queryURLEnd = "https://api.opencagedata.com/geocode/v1/json?q=" + endLoc + "&key=5de65d8b73e24f3c873540d0515d0f0a";

      var latitudeStart;
      var longitudeStart;

      var latitudeEnd;
      var longitudeEnd;
      
      getLocationData(queryURLStart, queryURLEnd);

    });

    function getLocationData(URLStart, URLEnd) {

      $.ajax({
        url: URLStart,
        method: "GET"
      })
        .then(function(response) {
          var results = response.results;
          latitudeStart = results[0].geometry.lat;
          console.log(latitudeStart);
          longitudeStart = results[0].geometry.lng;
          console.log(longitudeStart)

          $.ajax({
            url: URLEnd,
            method: "GET"
          })
            .then(function(response2) {
              var results2 = response2.results;
              latitudeEnd = results2[0].geometry.lat;
              console.log(latitudeStart)
              longitudeEnd = results2[0].geometry.lng;
              console.log(latitudeEnd)
              mapLocation(latitudeStart, longitudeStart, latitudeEnd, longitudeEnd);

            });
          
        });

      }

        function mapLocation(latStart, lngStart, latEnd, lngEnd) {
          console.log("mapLocation")
          var directionsDisplay;
          var directionsService = new google.maps.DirectionsService();
          var map;
          initialize();

          function initialize() {
            console.log("initialize");
            directionsDisplay = new google.maps.DirectionsRenderer();
            var chicago = new google.maps.LatLng(37.334818, -121.884886);
            var mapOptions = {
              zoom: 7,
              center: chicago
            };
            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            directionsDisplay.setMap(map);
            calcRoute();
          }

          function calcRoute() {
            var start = new google.maps.LatLng(latStart, lngStart);
            var end = new google.maps.LatLng(latEnd, lngEnd);
            var request = {
              origin: start,
              destination: end,
              travelMode: google.maps.TravelMode.DRIVING
            };
            directionsService.route(request, function(response, status) {
              if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                directionsDisplay.setMap(map);
              } else {
                alert("Directions Request from " + start.toUrlValue(6) + " to " + end.toUrlValue(6) + " failed: " + status);
              }
            });
          }
        }

    </script>

  </body>
</html>